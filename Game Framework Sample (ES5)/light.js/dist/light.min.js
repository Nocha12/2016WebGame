/*! light - v0.1.3 - 
 * http://ludev.kr
 * Copyright (c) 2014 Gidong Kwon*/
var Light=Light||{VERSION:"0.1.3",games:[],degToRad:function(a){return a*Math.PI/180},radToDeg:function(a){return 180*a/Math.PI},randomIn:function(a,b){return Math.floor(Math.random()*(b-a+1)+a)}};Light.Asset=function(a){this.game=a,this.loading=0,this.loaded=0,this.skip=!1,this.toLoad=[],this.image=[],this.audio=[]},Light.Asset.prototype.startLoad=function(){this.loading=this.toLoad.length;for(var a=0;a<this.loading;a++){var b=this.toLoad[a];switch(b.type){case"image":var c=new Image;c.src=b.url,c.index=a,c.addEventListener("load",this.onLoad.bind(this));break;case"audio":var d=new Audio(b.url);d.index=a,d.addEventListener("load",this.onLoad.bind(this)),d.dispatchEvent(new Event("load"))}}0===this.toLoad.length&&this.dispatchPreloaded()},Light.Asset.prototype.onLoad=function(a){var b=a.target.index;a.target.removeEventListener("load",this.onLoad),this[this.toLoad[b].type][this.toLoad[b].id]=a.target,this.loaded++,this.loaded===this.loading&&this.dispatchPreloaded()},Light.Asset.prototype.dispatchPreloaded=function(){var a;try{a=new CusomEvent("preloaded")}catch(b){a=document.createEvent("CustomEvent"),a.initEvent("preloaded",!1,!1)}finally{document.dispatchEvent(a),this.toLoad=[]}},Light.Asset.prototype.loadImage=function(a,b){this.toLoad.push({type:"image",id:a,url:b})},Light.Asset.prototype.loadAudio=function(a,b){this.toLoad.push({type:"audio",id:a,url:b})},Light.Asset.prototype.getImage=function(a){return this.image[a]},Light.Asset.prototype.getAudio=function(a){return this.audio[a]},Light.Game=function(a,b,c,d,e){this.inited=!1,this.parentId=a,this.width=b||800,this.height=c||600,this.backgroundColor=d||"#fff",this.asset=new Light.Asset(this),this.states=new Light.StateManager(this),Light.games.push(this),e(this.asset),document.addEventListener("DOMContentLoaded",this.asset.startLoad.bind(this.asset),!0),document.addEventListener("preloaded",this.init.bind(this))},Light.Game.constructor=Light.Game,Light.Game.prototype.init=function(){document.removeEventListener("DOMContentLoaded",this.asset.start,!0),document.removeEventListener("preloaded",this.init),this.parent="string"==typeof this.parentId?document.getElementById(this.parentId):document.body,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.parent.appendChild(this.canvas),this.context=this.canvas.getContext("2d");for(var a=["ms","moz","webkit","o"],b=0;b<a.length&&!window.requestAnimationFrame;b++)window.requestAnimationFrame=window[a[b]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[b]+"CancelAnimationFrame"];this.rafId=window.requestAnimationFrame(this.run.bind(this)),this.camera=new Light.Camera(this),this.input=new Light.Input(this),this.physics=new Light.Physics(this),this.timers=[],this.time=Date.now(),this.fpsStartTime=Date.now(),this.fps=60,this.inited=!0,this.states.current.onInit()},Light.Game.prototype.run=function(){this.elapsed=(Date.now()-this.time)/1e3,Date.now()-this.fpsStartTime>500&&(this.fpsStartTime=Date.now(),this.fps=Math.round(1/this.elapsed),this.fps>60&&(this.fps=60)),this.update(this.elapsed),this.render(),this.time=Date.now(),this.rafId=window.requestAnimationFrame(this.run.bind(this))},Light.Game.prototype.resume=function(){this.rafId=window.requestAnimationFrame(this.run.bind(this));for(var a=this.timers.length;a--;)this.timers[a].resume()},Light.Game.prototype.pause=function(){window.cancelAnimationFrame(rafId);for(var a=this.timers.length;a--;)this.timers[a].pause()},Light.Game.prototype.update=function(a){this.input.update(a),this.camera.update(a),this.physics.update(a),this.timers.forEach(function(b){b.update(a)}),null!==this.states.current&&this.states.current.update(a)},Light.Game.prototype.render=function(){var a=this.states.current,b=this;this.context.save(),this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,this.width,this.height);var c,d;c=this.camera.width/2,d=this.camera.height/2,this.context.translate(c,d),this.context.scale(this.camera.scale.x,this.camera.scale.y),this.context.translate(-c,-d),this.context.translate(-this.camera.x,-this.camera.y),a.children.forEach(function(a){a.render(b.context)}),this.context.restore(),this.camera.children.forEach(function(a){a.render(b.context)})},Light.StateManager=function(a){this.game=a,this.states={},this.currentState=null},Light.StateManager.constructor=Light.StateManager,Light.StateManager.prototype.add=function(a,b){return b instanceof Light.State?(this.states[a]=b,!0):!1},Light.StateManager.prototype.remove=function(a){return a in this.states?(delete states[a],!0):!1},Light.StateManager.prototype.change=function(a){this.currentState=this.states[a],this.game.inited&&(this.game.camera.reset(),this.game.physics.reset(),this.currentState.removeChildren(),this.currentState.onInit())},Object.defineProperty(Light.StateManager.prototype,"current",{get:function(){return this.currentState}}),Light.Timer=function(a,b,c,d){this.game=a,this.change(b,c),this.currentCount=0,this.callback=d,this.time=0,this.running=!1},Light.Timer.prototype.start=function(){this.running||(this.running=!0,this.game.timers.push(this))},Light.Timer.prototype.stop=function(){this.running&&(this.running=!1,this.game.timers.splice(this.game.timers.indexOf(this),1))},Light.Timer.prototype.reset=function(){this.running=!1,this.currentCount=0,this.time=0},Light.Timer.prototype.pause=function(){this.running&&(this.running=!1)},Light.Timer.prototype.resume=function(){this.running||(this.running=!0)},Light.Timer.prototype.change=function(a,b){this.delay=a,this.repeatCount=0!==b?b:1},Light.Timer.prototype.update=function(a){this.running&&(this.time+=a,this.time>=this.delay&&(this.time=0,this.callback(),++this.currentCount==this.repeatCount&&this.stop()))},Light.Point=function(a,b){this.x=a||0,this.y=b||0},Light.Point.constructor=Light.Point,Light.Point.prototype.set=function(a,b){return this.x=a,this.y=b,this},Light.Point.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this},Light.Point.prototype.subtract=function(a){return this.x-=a.x,this.y-=a.y,this},Light.Point.prototype.multiply=function(a){return this.x*=a.x,this.y*=a.y,this},Light.Point.prototype.divide=function(a){return this.x/=a.x,this.y/=a.y,this},Light.Point.prototype.offset=function(a,b){return this.x+=a,this.y+=b,this},Light.Point.prototype.getRotation=function(a){return Math.atan2(a.y-this.y,a.x-this.x)},Light.Point.prototype.getDistance=function(a){return Math.sqrt(a.x*a.x+a.y*a.y)},Light.Point.prototype.clone=function(){return new Light.Point(this.x,this.y)},Light.Rectangle=function(a,b,c,d){this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0},Light.Rectangle.constructor=Light.Rectangle,Light.Rectangle.prototype.getCenter=function(){return new Light.Point(this.x+this.width/2,this.y+this.height/2)},Light.Rectangle.prototype.intersects=function(a){return!(this.x+this.width<a.x||this.y+this.height<a.y||a.x+a.width<this.x||a.y+a.height<this.y)},Light.Rectangle.prototype.contains=function(a){return!(this.x>a.x||this.x+this.width<a.x||this.y>a.y||this.y+this.height<a.y)},Light.Rectangle.prototype.getIntersect=function(a){if(this.intersects(a)){var b=Math.max(this.x,a.x),c=Math.max(this.y,a.y),d=Math.min(this.x+this.width,a.x+a.width)-b,e=Math.min(this.y+this.height,a.y+a.height)-c;return new Light.Rectangle(b,c,d,e)}return null},Light.Rectangle.prototype.clone=function(){return new Light.Rectangle(this.x,this.y,this.width,this.height)},Light.Entity=function(){this.position=new Light.Point,this.rotation=0,this.rotationCenter=new Light.Point,this.scale=new Light.Point(1,1),this.scaleCenter=new Light.Point,this.alpha=1,this.visible=!0,this.parent=null,this._width=1,this._height=1},Light.Entity.constructor=Light.Entity,Light.Entity.prototype.render=function(a){a.save(),a.translate(this.x,this.y),a.translate(this.rotationCenter.x,this.rotationCenter.y),a.rotate(this.rotation),a.translate(-this.rotationCenter.x,-this.rotationCenter.y),a.translate(this.scaleCenter.x,this.scaleCenter.y),a.scale(this.scale.x,this.scale.y),a.translate(-this.scaleCenter.x,-this.scaleCenter.y),a.globalAlpha=this.alpha,this.onRender(a),a.restore()},Light.Entity.prototype.update=function(){},Light.Entity.prototype.getBounds=function(){return new Light.Rectangle(this.x,this.y,this.width,this.height)},Light.Entity.prototype.intersects=function(a){return this.getBounds().intersects(a.getBounds())},Light.Entity.prototype.getIntersect=function(a){return this.getBounds().getIntersect(a.getBounds())},Light.Entity.prototype.contains=function(a){return this.getBounds().contains(a)},Object.defineProperties(Light.Entity.prototype,{x:{get:function(){return this.position.x},set:function(a){this.position.x=a}},y:{get:function(){return this.position.y},set:function(a){this.position.y=a}},width:{get:function(){return this._width},set:function(a){this._width=a}},height:{get:function(){return this._height},set:function(a){this._height=a}}}),Light.EntityContainer=function(){Light.Entity.call(this),this.children=[]},Light.EntityContainer.prototype=Object.create(Light.Entity.prototype),Light.EntityContainer.constructor=Light.EntityContainer,Light.EntityContainer.prototype.onRender=function(a){this.children.forEach(function(b){b.render(a)})},Light.EntityContainer.prototype.update=function(a){this.children.forEach(function(b){b.update(a)})},Light.EntityContainer.prototype.addChild=function(a){a.parent=this,this.children.push(a)},Light.EntityContainer.prototype.removeChild=function(a){this.children.splice(this.children.indexOf(a),1)},Light.EntityContainer.prototype.removeChildren=function(a,b){a=a||0,b=b||this.children.length-1,this.children.splice(a,b-a)},Light.Sprite=function(a){Light.EntityContainer.call(this),"string"==typeof a?(this.texture=new Image,this.texture.src=a):(a instanceof Image||a.hasOwnProperty("src"))&&(this.texture=a)},Light.Sprite.prototype=Object.create(Light.EntityContainer.prototype),Light.Sprite.prototype.constructor=Light.Sprite,Light.Sprite.prototype.onRender=function(a){a.drawImage(this.texture,0,0),Light.EntityContainer.prototype.onRender.apply(this,arguments)},Object.defineProperties(Light.Sprite.prototype,{width:{get:function(){return this.texture.width*Math.abs(this.scale.x)},set:function(a){this.scale.x=Math.abs(a)/this.texture.width}},height:{get:function(){return this.texture.height*Math.abs(this.scale.y)},set:function(a){this.scale.y=Math.abs(a)/this.texture.height}}}),Light.MovieClip=function(a,b,c){Light.EntityContainer.call(this),this.texture=a,this.frameRect=b,this.totalFrames=c,this.framesPerRow=Math.floor(a.width/b.width),this.frameSpeed=frameSpeed,this.isLoop=!0,this.isPlaying=!1,this.width=this.frameRect.width,this.height=this.frameRect.height,this.frameCount=0},Light.MovieClip.prototype.constructor=Light.MovieClip,Light.MovieClip.prototype=Object.create(Light.EntityContainer.prototype),Light.MovieClip.prototype.play=function(a,b){this.isLoop="boolean"==typeof a?a:!0,this.frameSpeed="number"==typeof b?b:60,this.isPlaying=!0},Light.MovieClip.prototype.stop=function(a){a===!0&&(this.frameCount=0),this.isPlaying=!1},Light.MovieClip.prototype.update=function(a){Light.EntityContainer.prototype.update.apply(this,arguments),this.isPlaying&&(this.frameCount+=this.frameSpeed*a,this.frameCount>=this.totalFrames&&(this.frameCount=this.isLoop?0:this.totalFrames-1))},Light.MovieClip.prototype.onRender=function(a){a.drawImage(this.texture,this.width*Math.floor(this.currentFrame%this.framesPerRow),this.height*Math.floor(this.currentFrame/this.framesPerRow),this.width,this.height,0,0,this.width,this.height)},Object.defineProperty(Light.MovieClip.prototype,"currentFrame",{get:function(){return Math.floor(this.frameCount)}}),Light.Text=function(){Light.Entity.call(this),this.text="",this.font="20px Arial",this.baseline="top",this.fillStyle="#000000"},Light.Text.prototype=Object.create(Light.Entity.prototype),Light.Text.constructor=Light.Text,Light.Text.prototype.onRender=function(a){a.font=this.font,a.fillStyle=this.fillStyle,a.textBaseline=this.baseline,a.fillText(this.text,0,0)},Light.State=function(a){Light.EntityContainer.call(this),this.game=a},Light.State.prototype=Object.create(Light.EntityContainer.prototype),Light.State.constructor=Light.State,Light.State.prototype.update=function(a){Light.EntityContainer.prototype.update.apply(this,arguments),this.onUpdate(a)},Light.Camera=function(a){Light.EntityContainer.call(this),this.game=a,this.target=null,this.moveBounds=null,this.offset=new Light.Point,this.targetScale=new Light.Point(1,1),this.width=this.game.width,this.height=this.game.height,this.smoothFollow=1,this.smoothZoom=1,this.shakeMax=new Light.Point,this.shakeTimer=new Light.Timer(this.game,0,1,function(){this.x+=Light.randomIn(-this.shakeMax.x,this.shakeMax.x),this.y+=Light.randomIn(-this.shakeMax.y,this.shakeMax.y)}.bind(this))},Light.Camera.prototype=Object.create(Light.EntityContainer.prototype),Light.Camera.constructor=Light.Camera,Light.Camera.prototype.reset=function(){this.position.set(0,0),this.unfollow(),this.smoothFollow=1,this.smoothZoom=1,this.shakeMax.set(0,0),this.targetScale.set(1,1)},Light.Camera.prototype.follow=function(a,b){this.target=a,this.offset=b instanceof Light.Point?b:new Light.Point},Light.Camera.prototype.unfollow=function(){this.target=null,this.offset.x=0,this.offset.y=0},Light.Camera.prototype.shake=function(a,b,c,d){this.shakeMax.x=c,this.shakeMax.y=d,this.shakeTimer.change(a,b),this.shakeTimer.reset(),this.shakeTimer.start()},Light.Camera.prototype.zoom=function(a,b){this.targetScale.x=a,this.targetScale.y=b},Light.Camera.prototype.localToScreen=function(a){var b=new Light.Point;return b.x=(a.x-this.x)*this.scale.x,b.y=(a.y-this.y)*this.scale.y,b},Light.Camera.prototype.screenToLocal=function(a){var b=new Light.Point;return b.x=a.x/this.scale.x+this.x,b.y=a.y/this.scale.y+this.y,b},Light.Camera.prototype.update=function(){if(null!==this.target&&(this.x+=(this.target.x+this.target.width/2-this.width/2-this.offset.x-this.x)/this.smoothFollow,this.y+=(this.target.y+this.target.height/2-this.height/2-this.offset.y-this.y)/this.smoothFollow,this.scale.x+=(this.targetScale.x-this.scale.x)/this.smoothZoom,this.scale.y+=(this.targetScale.y-this.scale.y)/this.smoothZoom,this.moveBounds)){var a;a=this.moveBounds.x,this.x<=a&&(this.x=a),a=this.moveBounds.width-this.width,this.x>=a&&(this.x=a),a=this.moveBounds.y,this.y<=a&&(this.y=a),a=this.moveBounds.height-this.height,this.y>=a&&(this.y=a)}},Light.Input=function(a){this.game=a,this.keyboard=new Light.Keyboard(a),this.mouse=new Light.Mouse(a)},Light.Input.constructor=Light.Input,Light.Input.prototype.update=function(a){this.keyboard.update(a),this.mouse.update(a)},Light.Keyboard=function(a){this.game=a,this.keyPressed=[],this.keyCapturing=[],window.addEventListener("keydown",Light.Keyboard.prototype.onKeyDown.bind(this)),window.addEventListener("keyup",Light.Keyboard.prototype.onKeyUp.bind(this))},Light.Keyboard.prototype.contructor=Light.Keyboard,Light.Keyboard.prototype.update=function(a){var b=this;this.keyPressed.forEach(function(c,d){b.keyPressed[d].time+=a})},Light.Keyboard.prototype.onKeyDown=function(a){-1!=this.keyCapturing.indexOf(a.keyCode)&&(a.preventDefault(),a.keyCode in this.keyPressed||(this.keyPressed[a.keyCode]={time:0,justPressed:!0}))},Light.Keyboard.prototype.onKeyUp=function(a){delete this.keyPressed[a.keyCode]},Light.Keyboard.prototype.isJustPressed=function(a){var b;return(b=a in this.keyPressed&&this.keyPressed[a].justPressed)&&(this.keyPressed[a].justPressed=!1),b},Light.Keyboard.prototype.isPressed=function(a){return a in this.keyPressed},Light.Keyboard.A="A".charCodeAt(0),Light.Keyboard.B="B".charCodeAt(0),Light.Keyboard.C="C".charCodeAt(0),Light.Keyboard.D="D".charCodeAt(0),Light.Keyboard.E="E".charCodeAt(0),Light.Keyboard.F="F".charCodeAt(0),Light.Keyboard.G="G".charCodeAt(0),Light.Keyboard.H="H".charCodeAt(0),Light.Keyboard.I="I".charCodeAt(0),Light.Keyboard.J="J".charCodeAt(0),Light.Keyboard.K="K".charCodeAt(0),Light.Keyboard.L="L".charCodeAt(0),Light.Keyboard.M="M".charCodeAt(0),Light.Keyboard.N="N".charCodeAt(0),Light.Keyboard.O="O".charCodeAt(0),Light.Keyboard.P="P".charCodeAt(0),Light.Keyboard.Q="Q".charCodeAt(0),Light.Keyboard.R="R".charCodeAt(0),Light.Keyboard.S="S".charCodeAt(0),Light.Keyboard.T="T".charCodeAt(0),Light.Keyboard.U="U".charCodeAt(0),Light.Keyboard.V="V".charCodeAt(0),Light.Keyboard.W="W".charCodeAt(0),Light.Keyboard.X="X".charCodeAt(0),Light.Keyboard.Y="Y".charCodeAt(0),Light.Keyboard.Z="Z".charCodeAt(0),Light.Keyboard.BACKSPACE=8,Light.Keyboard.TAP=9,Light.Keyboard.ENTER=13,Light.Keyboard.COMMAND=15,Light.Keyboard.SHIFT=16,Light.Keyboard.CONTROL=17,Light.Keyboard.ALTERNATE=18,Light.Keyboard.CAPS_LOCK=20,Light.Keyboard.ESCAPE=27,Light.Keyboard.SPACE=32,Light.Keyboard.PAGE_UP=33,Light.Keyboard.PAGE_DOWN=34,Light.Keyboard.END=35,Light.Keyboard.HOME=36,Light.Keyboard.LEFT=37,Light.Keyboard.UP=38,Light.Keyboard.RIGHT=39,Light.Keyboard.DOWN=40,Light.Keyboard.INSERT=45,Light.Keyboard.DELETE=46,Light.Keyboard.NUMBER_1=49,Light.Keyboard.NUMBER_2=50,Light.Keyboard.NUMBER_3=51,Light.Keyboard.NUMBER_4=52,Light.Keyboard.NUMBER_5=53,Light.Keyboard.NUMBER_6=54,Light.Keyboard.NUMBER_7=55,Light.Keyboard.NUMBER_8=56,Light.Keyboard.NUMBER_9=57,Light.Keyboard.NUMPAD_0=96,Light.Keyboard.NUMPAD_1=97,Light.Keyboard.NUMPAD_2=98,Light.Keyboard.NUMPAD_3=99,Light.Keyboard.NUMPAD_4=100,Light.Keyboard.NUMPAD_5=101,Light.Keyboard.NUMPAD_6=102,Light.Keyboard.NUMPAD_7=103,Light.Keyboard.NUMPAD_8=104,Light.Keyboard.NUMPAD_9=105,Light.Keyboard.NUMPAD_MULTIPLY=106,Light.Keyboard.NUMPAD_ADD=107,Light.Keyboard.NUMPAD_ENTER=108,Light.Keyboard.NUMPAD_SUBTRACT=109,Light.Keyboard.NUMPAD_DEMICAL=110,Light.Keyboard.NUMPAD_DIVIDE=111,Light.Keyboard.F1=112,Light.Keyboard.F2=113,Light.Keyboard.F3=114,Light.Keyboard.F4=115,Light.Keyboard.F5=116,Light.Keyboard.F6=117,Light.Keyboard.F7=118,Light.Keyboard.F8=119,Light.Keyboard.F9=120,Light.Keyboard.F10=121,Light.Keyboard.F11=122,Light.Keyboard.F12=123,Light.Keyboard.F13=124,Light.Keyboard.F14=125,Light.Keyboard.F15=126,Light.Keyboard.SEMICOLON=186,Light.Keyboard.EQUAL=187,Light.Keyboard.COMMA=188,Light.Keyboard.MINUS=189,Light.Keyboard.PERIOD=190,Light.Keyboard.SLASH=191,Light.Keyboard.BACKQUOTE=192,Light.Keyboard.LEFTBRACKET=219,Light.Keyboard.BACKSLASH=220,Light.Keyboard.RIGHTBRACKET=221,Light.Keyboard.QUOTE=222,Light.Mouse=function(a){this.game=a,this.position=new Light.Point,this.buttonPressed=[],window.addEventListener("mouseup",Light.Mouse.prototype.onMouseUp.bind(this)),window.addEventListener("mousedown",Light.Mouse.prototype.onMouseDown.bind(this)),window.addEventListener("mousemove",Light.Mouse.prototype.onMouseMove.bind(this))},Light.Mouse.prototype.contructor=Light.Mouse,Light.Mouse.prototype.update=function(a){var b=this;this.buttonPressed.forEach(function(c,d){b.buttonPressed[d].time+=a})},Light.Mouse.prototype.onMouseUp=function(a){delete this.buttonPressed[a.button]},Light.Mouse.prototype.onMouseDown=function(a){this.buttonPressed[a.button]={time:0,justPressed:!0}},Light.Mouse.prototype.onMouseMove=function(a){var b=this.game.canvas.getBoundingClientRect();this.x=a.clientX-b.left,this.y=a.clientY-b.top},Light.Mouse.prototype.isJustPressed=function(a){var b;return(b=a in this.buttonPressed&&this.buttonPressed[a].justPressed)&&(this.buttonPressed[a].justPressed=!1),b},Light.Mouse.prototype.isPressed=function(a){return a in this.buttonPressed},Object.defineProperties(Light.Mouse.prototype,{x:{get:function(){return this.position.x},set:function(a){this.position.x=a}},y:{get:function(){return this.position.y},set:function(a){this.position.y=a}}}),Light.Mouse.LEFT=0,Light.Mouse.MIDDLE=1,Light.Mouse.RIGHT=2,Light.Physics=function(a){this.game=a,this.entities=[],this.gravity=new Light.Point},Light.Physics.prototype.contructor=Light.Physics,Light.Physics.prototype.reset=function(){this.entities=[],this.gravity.set(0,0)},Light.Physics.prototype.add=function(a){a.body=new Light.Body(a),this.entities.push(a)},Light.Physics.prototype.remove=function(a){var b;-1!=(b=this.entities.indexOf(a))&&(delete a.body,this.entities.splice(b,1))},Light.Physics.prototype.collide=function(a,b){var c;null!==(c=a.getIntersect(b))&&(c.width<c.height?(a.getBounds().getCenter().x<b.getBounds().getCenter().x?(a.body.touching.right=!0,b.body.touching.left=!0,a.body.isFixed||b.body.isFixed?a.body.isFixed?b.body.isFixed||(b.x+=c.width):a.x-=c.width:(a.x-=c.width/2,b.x+=c.width/2)):(a.body.touching.left=!0,b.body.touching.right=!0,a.body.isFixed||b.body.isFixed?a.body.isFixed?b.body.isFixed||(b.x-=c.width):a.x+=c.width:(a.x+=c.width/2,b.x-=c.width/2)),a.body.velocity.x=0,b.body.velocity.x=0):(a.getBounds().getCenter().y<b.getBounds().getCenter().y?(a.body.touching.bottom=!0,b.body.touching.top=!0,a.body.isFixed||b.body.isFixed?a.body.isFixed?b.body.isFixed||(b.y+=c.height):a.y-=c.height:(a.y-=c.height/2,b.y+=c.height/2)):(a.body.touching.top=!0,b.body.touching.bottom=!0,a.body.isFixed||b.body.isFixed?a.body.isFixed?b.body.isFixed||(b.y-=c.height):a.y+=c.height:(a.y+=c.height/2,b.y-=c.height/2)),a.body.velocity.y=0,b.body.velocity.y=0))},Light.Physics.prototype.update=function(a){for(var b=0;b<this.entities.length;b++){var c=this.entities[b];if(c.body.update(a),c.body.isFixed||(c.body.isGravityAllowed&&(c.body.velocity.x+=(this.gravity.x+c.body.gravity.x)*a,c.body.velocity.y+=(this.gravity.y+c.body.gravity.y)*a),c.body.velocity.x>c.body.maxVelocity.x?c.body.velocity.x=c.body.maxVelocity.x:c.body.velocity.x<-c.body.maxVelocity.x&&(c.body.velocity.x=-c.body.maxVelocity.x),c.body.velocity.y>c.body.maxVelocity.y?c.body.velocity.y=c.body.maxVelocity.y:c.body.velocity.y<-c.body.maxVelocity.y&&(c.body.velocity.y=c.body.maxVelocity.y),c.position.add(c.body.velocity),c.body.velocity.multiply(c.body.friction)),c.body.isCollisionAllowed)for(var d=0;d<this.entities.length;d++)c!==this.entities[d]&&this.entities[d].body.isCollisionAllowed&&this.game.physics.collide(c,this.entities[d])}},Light.Body=function(a){Light.Entity.call(this),this.parent=a,this.velocity=new Light.Point,this.maxVelocity=new Light.Point,this.gravity=new Light.Point,this.friction=new Light.Point(1,1),this.touching={top:!1,left:!1,right:!1,bottom:!1},this.isFixed=!1,this.isGravityAllowed=!0,this.isCollisionAllowed=!0,this.prevParentPosition=new Light.Point},Light.Body.prototype.update=function(){this.prevParentPosition=this.parent.position,this.touching.top=!1,this.touching.left=!1,this.touching.right=!1,this.touching.bottom=!1};